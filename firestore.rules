{
  "rules": {
    "databases": {
      "{database}": {
        "documents": {
          "players": {
            // Any authenticated user can list players for the leaderboard
            "allow": ["list"],
            "if": "request.auth != null"
          },
          "players/{userId}": {
            // A user can create their own player document
            // A user can only get, update their own document. No one else can.
            "allow": ["get", "update"],
            "if": "request.auth.uid == userId"
          },
          "battles/{battleId}": {
            "allow": ["create"],
            "if": "request.auth.uid != null"
          },
          "battles/{battleId}": {
            // Only players in the battle can read or update it
            "allow": ["read", "update"],
            "if": "request.auth.uid == resource.data.player1.id || request.auth.uid == resource.data.player2.id"
          },
          "matchHistory/{historyId}": {
            // A user can create their own match history entry
            "allow": ["create"],
            "if": "request.auth.uid != null && request.auth.uid == request.resource.data.playerId"
          },
          "matchHistory": {
            // A user can only list their own match history
            "allow": ["list"],
_           "if": "request.auth != null && request.query.filters[0].value == request.auth.uid"
          }
        }
      }
    }
  }
}